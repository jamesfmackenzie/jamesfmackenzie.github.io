<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Download Pocket Videos to Your PC</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Tech, Programming, Agile, Software Engineering, Software, Hardware, Science, Video Games">
    <link rel="canonical" href="http://www.jamesfmackenzie.com/download-pocket-videos-to-your-pc">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">

    <!-- Custom CSS & Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
    <link rel="stylesheet" href="/style.css">

    <!-- Custom Fonts -->
    <link rel="stylesheet" href="/css/font-awesome/css/font-awesome.min.css">
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

    <body id="page-top" class="index">
       <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">jamesfmackenzie</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>
	    <!-- Header -->
    <header>
        <div class="container post-container">
            <div class="row">
                <div class="col-lg-12">
                    <!--<img class="img-responsive" src="../img/projects/" alt="">-->
                    <div class="intro-text">
                        <span class="name">Download Pocket Videos to Your PC</span>
                        <hr class="star-light">
                        <span class="skills"></span>
                    </div>
                </div>
            </div>
        </div>
    </header>
	<section id="posts">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 text-center">
					<h2></h2>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<p>As mentioned <a href="/getting-started-with-the-pocket-developer-api/">before</a>, I love <a href="http://wwww.getpocket.com" target="_blank">Pocket</a>. Commuting for 2 hours a day and often with patchy cellular signal, I keep Pocket topped up with plenty of reading material - ready to go at a moment’s notice.</p>

<p>One major bugbear I do have, though, is its inability to download and cache web videos for offline viewing. I do understand why they don’t support it (licensing concerns), but wouldn’t it be great to take a bunch of YouTube videos with you on the commute? Or on a plane?</p>

<p>Well here’s how.</p>

<h3 id="step-1-download-required-tooling">Step 1. Download required tooling</h3>

<p>Download and install the following tools on your machine. You’ll need to make sure they’re in your <a href="http://en.wikipedia.org/wiki/PATH_%28variable%29" target="_blank">PATH</a> too (<a href="http://www.computerhope.com/issues/ch000549.htm" target="_blank">this</a> might help).</p>

<ul>
  <li><a href="http://curl.haxx.se/" target="_blank">cURL</a> - “a command line tool and library for transferring data with URL syntax”</li>
  <li><a href="http://stedolan.github.io/jq/" target="_blank">jq</a> - “a lightweight and flexible command-line JSON processor”</li>
  <li><a href="http://rg3.github.io/youtube-dl/" target="_blank">youtube-dl</a> - “a small command-line program to download videos from YouTube.com and a few more sites”</li>
</ul>

<h3 id="step-2-get-a-pocket-access-token">Step 2. Get a Pocket Access token</h3>

<p>You’ll need a Pocket Access token before you can make authenticated requests against the Pocket API. Follow my guide <a href="/getting-started-with-the-pocket-developer-api/">here</a> to get one.</p>

<h3 id="step-3-ask-the-pocket-api-which-of-your-items-have-embedded-videos">Step 3. Ask the Pocket API which of your items have embedded videos</h3>

<p>Using cURL, make an authenticated request against the Pocket API and download all the items which have a contentType of “video”. You’ll need to swap out the consumer key and access token below for your own.</p>

<p><strong>Method URL</strong></p>
<pre>
https://getpocket.com/v3/get
</pre>

<p><strong>Example HTTP Request</strong></p>
<pre>
POST /v3/get HTTP/1.1
Host: getpocket.com
Content-Type: application/json

{"consumer_key":"1234-abcd1234abcd1234abcd1234",
"access_token":"5678defg-5678-defg-5678-defg56",
"detailType":"complete",
"contentType":"video"}
</pre>

<p><strong>Example HTTP Request (cURL)</strong></p>
<pre>
curl http://getpocket.com/v3/get -X POST -H "Content-Type: application/json" -H "X-Accept: application/json" -d "{\"consumer_key\":\"1234-abcd1234abcd1234abcd1234\", \"access_token\":\"5678defg-5678-defg-5678-defg56\", \"detailType\":\"complete\", \"contentType\":\"video\"}"
</pre>

<p><strong>Example HTTP Response</strong></p>
<pre>
{
  "status": 1,
  "complete": 1,
  "list": {
    "796410494": {
      "item_id": "796410494",
      "resolved_id": "796410494",
      "given_url": "https://m.youtube.com/watch?feature=youtu.be%26v=vXr-2hwTk58",
      "given_title": "The Internets Own Boy: The Story of Aaron Swartz",
      "favorite": "0",
      "status": "0",
      "time_added": "1419176466",
      "time_updated": "1419176466",
      "time_read": "0",
      "time_favorited": "0",
      "sort_id": 0,
      "resolved_title": "The Internet's Own Boy: The Story of Aaron Swartz (CC available: en,es,ru,fr,it,tr,cn,ja,vi)",
      "resolved_url": "https://m.youtube.com/watch?feature=youtu.be%26v=vXr-2hwTk58",
      "excerpt": "The film follows the story of programming prodigy and information activist Aaron Swartz. From Swartz's help in the development of the basic internet protocol RSS to his co-founding of Reddit, his fingerprints are all over the internet. But it was Swartz's groundbreaking work in social justice and po",
      "is_article": "0",
      "is_index": "0",
      "has_video": "2",
      "has_image": "1",
      "word_count": "0",
      "tags": {
        "onlineonly": {
          "item_id": "796410494",
          "tag": "onlineonly"
        }
      },
      "image": {
        "item_id": "796410494",
        "src": "http://img.youtube.com/vi/vXr-2hwTk58/0.jpg",
        "width": "480",
        "height": "360"
      },
      "images": {
        "1": {
          "item_id": "796410494",
          "image_id": "1",
          "src": "http://img.youtube.com/vi/vXr-2hwTk58/0.jpg",
          "width": "480",
          "height": "360",
          "credit": "",
          "caption": ""
        }
      },
      "videos": {
        "1": {
          "item_id": "796410494",
          "video_id": "1",
          <span style="background-color:yellow">"src": "http://www.youtube.com/v/vXr-2hwTk58",</span>
          "width": "0",
          "height": "0",
          "type": "1",
          "vid": "vXr-2hwTk58"
        }
      }
    },
    "766276760": {
      "item_id": "766276760",
      "resolved_id": "766276760",
      "given_url": "http://vimeo.com/m/49367318",
      "given_title": "Design For Replaceability - Architecture For An Agile Lifestyle",
      "favorite": "0",
      "status": "0",
      "time_added": "1419176466",
      "time_updated": "1419176466",
      "time_read": "0",
      "time_favorited": "0",
      "sort_id": 1,
      "resolved_title": "Design For Replaceability - Architecture For An Agile Lifestyle",
      "resolved_url": "http://vimeo.com/m/49367318",
      "excerpt": "The most important question to be asked when developing a new software system is \"How will we replace it?\" It is however a question seldom asked. Instead organization focus on reusability, which unfortunately helps create rigid and inflexible architectures. The talk shows how to design systems made",
      "is_article": "0",
      "is_index": "0",
      "has_video": "2",
      "has_image": "1",
      "word_count": "0",
      "tags": {
        "onlineonly": {
          "item_id": "766276760",
          "tag": "onlineonly"
        }
      },
      "authors": {
        "1288911": {
          "item_id": "766276760",
          "author_id": "1288911",
          "name": "JavaZone",
          "url": "http://vimeo.com/javazone"
        }
      },
      "image": {
        "item_id": "766276760",
        "src": "http://i.vimeocdn.com/video/340591828_640.jpg",
        "width": "640",
        "height": "360"
      },
      "images": {
        "1": {
          "item_id": "766276760",
          "image_id": "1",
          "src": "http://i.vimeocdn.com/video/340591828_640.jpg",
          "width": "640",
          "height": "360",
          "credit": "",
          "caption": ""
        }
      },
      "videos": {
        "1": {
          "item_id": "766276760",
          "video_id": "1",
          <span style="background-color:yellow">"src": "http://vimeo.com/play_redirect?clip_id=49367318&amp;quality=hd",</span>
          "width": "0",
          "height": "0",
          "type": "2",
          "vid": "49367318"
        }
      }
    },
   
... Lots more JSON
</pre>

<p>See the <span style="background-color:yellow">highlighted lines</span> above? We want to download the video from each one of those URLs. But first we need to parse them out somehow.</p>

<h3 id="step-4-parse-out-video-urls-using-jq">Step 4. Parse out video URLs using jq</h3>

<p>jq is a command line JSON processor. We can use it to separate out our previous video URLs from all that other JSON data - and dump the results into a file. Here’s how:</p>

<p><strong>This command line call …</strong></p>
<pre>
curl http://getpocket.com/v3/get -X POST -H "Content-Type: application/json" -H "X-Accept: application/json" -d "{\"consumer_key\":\"35939-55223ffc2c3e123d25dc67e4\", \"access_token\":\"b59ef60e-a7fe-76a8-750b-87edfc\", \"detailType\":\"complete\", \"contentType\":\"video\"}" | jq -r .list[].videos[]?.src &gt; output.txt
</pre>

<p><strong>… dumps all the video URLs in the response body to output.txt</strong></p>
<pre>
output.txt
----
http://www.youtube.com/v/vXr-2hwTk58
http://vimeo.com/play_redirect?clip_id=49367318&amp;quality=hd
http://www.youtube.com/embed/BTUMKkAXe7M?showsearch=0&amp;modestbranding=1
http://www.youtube.com/v/QdVFvsCWXrA
//www.youtube.com/embed/UXjTEw9Qm0k
http://no-mans-sky.com/elk/wp-content/themes/nomanssky/images/loop.mp4
http://no-mans-sky.com/elk/wp-content/themes/nomanssky/images/loop.webm
http://www.youtube.com/v/1sFhOWPD-uA?fs=1&amp;hl=en_US
http://player.vimeo.com/video/70417843
http://www.youtube.com/embed/TCswu85rJYY?wmode=transparent&amp;rel=0&amp;autohide=1&amp;showinfo=0&amp;enablejsapi=1
http://www.youtube.com/embed/Snyo6kSnGt4?wmode=transparent&amp;rel=0&amp;autohide=1&amp;showinfo=0&amp;enablejsapi=1
http://www.youtube.com/v/PGRRXKek8G0
chezbruce.swf
rc_img/rc_logo_2.swf
http://www.youtube.com/embed/AcqWohF1YFo
http://www.youtube.com/v/u0tSlCt33ac&amp;hl=ru_RU&amp;fs=1&amp;autoplay=1
//www.youtube.com/embed/YxgsxaFWWHQ
</pre>

<p>If you’re interested in jq, you can find out more <a href="http://stedolan.github.io/jq/" target="_blank">here</a>. But back to the task at hand. We have a bunch of video URLs. How do we download them?</p>

<h3 id="step-5-download-videos-using-youtube-dl">Step 5. Download videos using youtube-dl</h3>

<p>Youtube-dl is an open source video downloader. It was initially built for YouTube only, but it’s expanded over time to support many online video sites and formats.</p>

<p><strong>This command line call …</strong></p>
<pre>
youtube-dl.exe --ignore-errors --batch-file ./video-downloader/urls.txt --continue --no-part --no-overwrites -f 135+140/0 1&gt;&gt; ./video-downloader/log.txt 2&gt;&amp;1
</pre>

<p><strong>… downloads all the videos referenced in output.txt to the current directory</strong></p>

<p><img src="/img/posts/2015-01-03-00_36_48-Downloaded-Videos.png" alt="" /></p>

<p>To find out more about the youtube-dl configuration options, head over <a href="http://rg3.github.io/youtube-dl/documentation.html" target="_blank">here</a>. You should also read up on <a href="http://en.wikipedia.org/wiki/YouTube#Quality_and_formats" target="_blank">YouTube’s Media and Encoding Options</a>.</p>

<h3 id="step-6-putting-it-all-together">Step 6. Putting it all together</h3>

<p>That’s it! Pretty easy right? To make things even easier, copy and paste the lines below into a new cmd script (I called mine <code>video-downloader.cmd</code>) and leave it minimized and running on your PC. Any videos you add to Pocket will be automatically downloaded to your PC - ace!</p>

<pre>
:beginloop

:: download, parse video URLs from Pocket and flush into a text file
curl http://getpocket.com/v3/get -X POST -H "Content-Type: application/json" -H "X-Accept: application/json" -d "{\"consumer_key\":\"1234-abcd1234abcd1234abcd1234\", \"access_token\":\"5678defg-5678-defg-5678-defg56\", \"detailType\":\"complete\", \"contentType\":\"video\"}" | jq -r .list[].videos[]?.src &gt; urls.txt

:: download videos to the file system, skipping those already downloaded
youtube-dl.exe --restrict-filenames --ignore-errors --batch-file urls.txt --continue --no-part --no-overwrites -f 135+140/18/h264-sd/mp4/webm/swf/0 1&gt;&gt; log.txt 2&gt;&amp;1

:: sleep for 20 minutes
timeout /t 1200 /nobreak

:: start again
goto beginloop
</pre>


				</div>
			</div>
		</div>
	</section>
        <!-- Footer -->
    <footer class="text-center">
        <div class="footer-above">
            <div class="container">
                <div class="row">
                    <div class="footer-col col-md-4">
                        <h3></h3>
                        <p>
                            
                        </p>
                    </div>
                    <div class="footer-col col-md-4">
                        <h3>Social</h3>
                        <ul class="list-inline">
                            
                            <li>
                                <a href="http://twitter.com/jamesfmackenzie" class="btn-social btn-outline"><i class="fa fa-fw fa-twitter"></i></a>
                            </li>
		                    
                            <li>
                                <a href="http://stackoverflow.com/users/4958467/jamesfmackenzie" class="btn-social btn-outline"><i class="fa fa-fw fa-stack-overflow"></i></a>
                            </li>
		                    
                            <li>
                                <a href="http://github.com/jamesfmackenzie" class="btn-social btn-outline"><i class="fa fa-fw fa-github"></i></a>
                            </li>
		                    
                        </ul>
                    </div>
                    <div class="footer-col col-md-4">
                        <h3></h3>
                        <p></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-below">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        Copyright &copy; James Mackenzie 2015
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
    <div class="scroll-top page-scroll visible-xs visible-sm">
        <a class="btn btn-primary" href="#page-top">
            <i class="fa fa-chevron-up"></i>
        </a>
    </div>

     <!-- jQuery Version 1.11.0 -->
    <script src="/js/jquery-1.11.0.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="/js/jquery.easing.min.js"></script>
    <script src="/js/classie.js"></script>
    <script src="/js/cbpAnimatedHeader.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="/js/jqBootstrapValidation.js"></script>
    
    <script src="/js/contact_me_static.js"></script>
    

    <!-- Custom Theme JavaScript -->
    <script src="/js/freelancer.js"></script>

    </body>
</html>